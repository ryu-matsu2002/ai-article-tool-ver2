<!-- templates/post_log.html -->
{% extends 'base.html' %}
{% block title %}æŠ•ç¨¿ãƒ­ã‚°{% endblock %}

{% block content %}
<h2>ğŸ“ æŠ•ç¨¿ãƒ­ã‚°ä¸€è¦§</h2>

<!-- ğŸ”˜ è¨˜äº‹ç”Ÿæˆé–‹å§‹ãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="POST" action="{{ url_for('main.start_generation') }}" class="mb-4 border p-3 rounded bg-light">
  <div class="row g-3 align-items-center">
    <div class="col-auto">
      <label for="site_id" class="col-form-label">ã‚µã‚¤ãƒˆï¼š</label>
    </div>
    <div class="col-auto">
      <select name="site_id" id="site_id" class="form-select">
        {% for site in user_sites %}
          <option value="{{ site.id }}">{{ site.site_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <label for="genre" class="col-form-label">ã‚¸ãƒ£ãƒ³ãƒ«ï¼š</label>
    </div>
    <div class="col-auto">
      <input type="text" name="genre" id="genre" class="form-control" required placeholder="ä¾‹ï¼šæ—…è¡Œã€ç¾å®¹ã€å¥åº·">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">ğŸ› ï¸ è¨˜äº‹ç”Ÿæˆé–‹å§‹</button>
    </div>
  </div>
</form>

<!-- âœ… ã‚µã‚¤ãƒˆåˆ¥åˆ‡ã‚Šæ›¿ãˆ -->
<form method="get" class="mb-3 d-flex flex-wrap align-items-center gap-3">
  <div>
    <label class="form-label me-1">ã‚µã‚¤ãƒˆé¸æŠï¼š</label>
    <select name="site_id" class="form-select w-auto d-inline" onchange="this.form.submit()">
      <option value="">ã™ã¹ã¦ã®ã‚µã‚¤ãƒˆ</option>
      {% for site in user_sites %}
        <option value="{{ site.id }}" {% if selected_site_id == site.id %}selected{% endif %}>
          {{ site.site_name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹çµã‚Šè¾¼ã¿ -->
  <div>
    <label class="form-label me-1">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š</label>
    <select name="status" class="form-select w-auto d-inline" onchange="this.form.submit()">
      <option value="">ã™ã¹ã¦</option>
      <option value="generating" {% if selected_status == 'generating' %}selected{% endif %}>âš™ï¸ ç”Ÿæˆä¸­</option>
      <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>â³ æœªæŠ•ç¨¿</option>
      <option value="scheduled" {% if selected_status == 'scheduled' %}selected{% endif %}>ğŸ“… æŠ•ç¨¿äºˆå®š</option>
      <option value="posted" {% if selected_status == 'posted' %}selected{% endif %}>âœ… æŠ•ç¨¿æ¸ˆ</option>
      <option value="failed" {% if selected_status == 'failed' %}selected{% endif %}>âŒ å¤±æ•—</option>
    </select>
  </div>
</form>

<!-- âœ… è¨˜äº‹ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>ID</th>
      <th>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</th>
      <th>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</th>
      <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
      <th>æŠ•ç¨¿äºˆå®š</th>
      <th>ä½œæˆæ—¥æ™‚</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for article in articles %}
    <tr>
      <td>{{ article.id }}</td>
      <td style="max-width: 320px;">
        <div class="preview" style="font-size: 0.9em;">{{ article.preview_html | safe }}</div>
      </td>
      <td>{{ article.keyword }}</td>
      <td>
        {% if article.status == 'generating' %}
          âš™ï¸ ç”Ÿæˆä¸­
        {% elif article.status == 'pending' %}
          â³ æœªæŠ•ç¨¿
        {% elif article.status == 'scheduled' %}
          ğŸ“… æŠ•ç¨¿äºˆå®š
        {% elif article.status == 'posted' %}
          âœ… æŠ•ç¨¿æ¸ˆ
        {% elif article.status == 'failed' %}
          âŒ å¤±æ•—
        {% else %}
          {{ article.status }}
        {% endif %}
      </td>
      <td>{{ article.scheduled_time or '-' }}</td>
      <td>{{ article.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
      <td class="text-nowrap">
        <a class="btn btn-sm btn-outline-primary mb-1" href="{{ url_for('main.article_detail', article_id=article.id) }}">ğŸ”</a>
        <a class="btn btn-sm btn-outline-secondary mb-1" href="{{ url_for('main.edit_article', article_id=article.id) }}">âœï¸</a>
        {% if article.status == 'failed' %}
        <form method="POST" action="{{ url_for('main.retry_post', article_id=article.id) }}" style="display:inline;">
          {{ csrf_token() }}
          <button class="btn btn-sm btn-outline-danger" type="submit">ğŸ”„</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr><td colspan="7">è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
